{# templates/dashboard/index.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Budget Dashboard - SoloLevelers{% endblock %}

{% block body %}
    <!-- Hero Section -->
    <section class="hero">
        <div class="aurora-bg"></div>
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8 mx-auto text-center">
                    <h1 class="hero-title">Budget Dashboard</h1>
                    <p class="hero-subtitle">Overzicht van je financiële gezondheid</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="mission-section">
        <div class="container">
            <!-- Financial Summary Cards -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto">
                    <div class="row">
                        <div class="col-md-6 col-lg-3 mb-4">
                            <div class="feature-card text-center glow-card h-100">
                                <div class="feature-icon mx-auto">
                                    <i class="fas fa-arrow-down text-success"></i>
                                </div>
                                <h3 class="feature-title">Inkomsten</h3>
                                <div class="stat-number text-success">€{{ financialData.totalIncome|number_format(2, ',', '.') }}</div>
                                <p class="text-muted">Totale inkomsten</p>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-4">
                            <div class="feature-card text-center glow-card h-100">
                                <div class="feature-icon mx-auto">
                                    <i class="fas fa-arrow-up text-danger"></i>
                                </div>
                                <h3 class="feature-title">Uitgaven</h3>
                                <div class="stat-number text-danger">€{{ financialData.totalExpenses|number_format(2, ',', '.') }}</div>
                                <p class="text-muted">Totale uitgaven</p>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-4">
                            <div class="feature-card text-center glow-card h-100">
                                <div class="feature-icon mx-auto">
                                    <i class="fas fa-balance-scale {% if financialData.netBalance >= 0 %}text-success{% else %}text-danger{% endif %}"></i>
                                </div>
                                <h3 class="feature-title">Netto Saldo</h3>
                                <div class="stat-number {% if financialData.netBalance >= 0 %}text-success{% else %}text-danger{% endif %}">
                                    €{{ financialData.netBalance|number_format(2, ',', '.') }}
                                </div>
                                <p class="text-muted">Huidige balans</p>
                            </div>
                        </div>

                        <div class="col-md-6 col-lg-3 mb-4">
                            <div class="feature-card text-center glow-card h-100">
                                <div class="feature-icon mx-auto">
                                    <i class="fas fa-percentage {% if financialData.expenseRatio < 70 %}text-success{% elseif financialData.expenseRatio < 90 %}text-warning{% else %}text-danger{% endif %}"></i>
                                </div>
                                <h3 class="feature-title">Uitgave Ratio</h3>
                                <div class="stat-number {% if financialData.expenseRatio < 70 %}text-success{% elseif financialData.expenseRatio < 90 %}text-warning{% else %}text-danger{% endif %}">
                                    {{ financialData.expenseRatio|number_format(1) }}%
                                </div>
                                <p class="text-muted">Uitgaven/Inkomsten</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug info (tijdelijk toevoegen om te testen) -->
            <div class="row mb-4">
                <div class="col-lg-10 mx-auto">
                    <div class="feature-card">
                        <h4 class="feature-title">Debug Info</h4>
                        <p><strong>Aantal transacties:</strong> {{ financialData.transactionCount }}</p>
                        <p><strong>Transacties:</strong></p>
                        <ul>
                            {% for transaction in app.user.transactions %}
                                <li>
                                    {{ transaction.category.name }}:
                                    {{ transaction.getDisplayAmount() }}
                                    ({{ transaction.date|date('d-m-Y') }})
                                    - Type: {% if transaction.isIncome() %}Income{% else %}Expense{% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto">
                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="feature-card text-center h-100">
                                <h3 class="feature-title">Transacties</h3>
                                <div class="stat-number">{{ financialData.transactionCount }}</div>
                                <p class="text-muted">Totaal aantal</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="feature-card text-center h-100">
                                <h3 class="feature-title">Spaarquote</h3>
                                <div class="stat-number {% if financialData.savingsRate >= 0 %}text-success{% else %}text-danger{% endif %}">
                                    {{ financialData.savingsRate|number_format(1) }}%
                                </div>
                                <p class="text-muted">Van je inkomen</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="feature-card text-center h-100">
                                <h3 class="feature-title">Gemiddeld</h3>
                                <div class="stat-number">€{{ financialData.averageTransaction|number_format(2, ',', '.') }}</div>
                                <p class="text-muted">Per transactie</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Breakdown -->
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div class="feature-card">
                        <div class="text-center mb-4">
                            <h3 class="feature-title">Categorie Overzicht</h3>
                        </div>
                        <div class="row">
                            {% for category, data in financialData.categoryBreakdown %}
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="d-flex justify-content-between align-items-center p-3" style="background: rgba(28, 52, 38, 0.6); border-radius: 10px;">
                                        <div class="d-flex align-items-center">
                                            <div class="category-color me-3" style="width: 12px; height: 12px; border-radius: 50%; background-color: {{ cycle(['#16F98A', '#134338', '#FFCF44', '#FF6B6B', '#4ECDC4'], loop.index0) }}"></div>
                                            <span class="fw-medium">{{ category }}</span>
                                        </div>
                                        <div class="text-end">
                                            <div class="fw-bold {% if data.type == 'income' %}text-success{% else %}text-danger{% endif %}">
                                                €{{ data.total|number_format(2, ',', '.') }}
                                            </div>
                                            <small class="text-muted">{{ data.count }} transacties</small>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}